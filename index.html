<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JANUARY 2026: FOUNDATIONS (Cloud Sync)</title>
    <style>
        :root {
            --bg: #f4f7f6; --card-bg: #ffffff; --text: #333; --accent: #2c3e50;
            --highlight: #3498db; --success: #27ae60; --warning: #f39c12;
            --buffer: #95a5a6; --border: #e0e0e0;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; }

        /* Sync Controls */
        .sync-panel {
            background: #2c3e50; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px;
            display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: center;
        }
        .sync-panel input { padding: 8px; border-radius: 4px; border: none; font-size: 0.8rem; }
        .sync-btn { background: var(--success); color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .sync-btn.load { background: var(--highlight); }

        header { text-align: center; margin-bottom: 30px; }
        h1 { margin: 0; color: var(--accent); }
        .subtitle { color: var(--highlight); font-weight: 600; letter-spacing: 1px; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: var(--card-bg); padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; }
        .stat-val { font-size: 1.5rem; font-weight: bold; color: var(--accent); }
        .stat-label { font-size: 0.9rem; color: #666; }

        .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: var(--card-bg); padding: 10px 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        button.secondary { background: transparent; color: var(--accent); border: 1px solid var(--accent); padding: 8px 16px; border-radius: 5px; cursor: pointer; }

        .day-view { background: var(--card-bg); border-radius: 12px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; border-top: 5px solid var(--accent); }
        .task-list { list-style: none; padding: 0; }
        .task-item { display: flex; align-items: flex-start; padding: 10px; border-bottom: 1px solid var(--border); }
        .task-item.completed .task-desc { text-decoration: line-through; color: #aaa; }
        .checkbox { margin-right: 15px; margin-top: 5px; width: 20px; height: 20px; cursor: pointer; }

        textarea { width: 100%; height: 100px; padding: 10px; border: 1px solid var(--border); border-radius: 5px; margin-top: 10px; font-family: inherit; }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 40px; }
        .cal-day { background: white; padding: 5px; min-height: 60px; border: 1px solid var(--border); font-size: 0.8rem; cursor: pointer; }
        .cal-day.active { border: 2px solid var(--accent); }
        .cal-status { display: block; height: 4px; width: 100%; background: #eee; margin-top: 5px; }
        .cal-status-bar { height: 100%; background: var(--success); width: 0%; }
        
        .tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; margin-left: 10px; }
        .tag.morning-pages { background: #e8f6f3; color: #1abc9c; }
        .tag.academic { background: #eaf2f8; color: #3498db; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>JANUARY 2026</h1>
        <div class="subtitle">THEME: FOUNDATIONS (PERSISTENT DATA)</div>
    </header>

    <div class="sync-panel">
        <input type="password" id="gh-token" placeholder="GitHub Personal Access Token">
        <input type="text" id="gist-id" placeholder="Gist ID (leave blank for new)">
        <div>
            <button class="sync-btn load" onclick="syncFromCloud()">Cloud Load</button>
            <button class="sync-btn" onclick="syncToCloud()">Cloud Save</button>
        </div>
    </div>

    <div class="stats-grid" id="stats-container">
        <div class="stat-card"><div class="stat-val" id="progress-val">0%</div><div class="stat-label">Completion</div></div>
        <div class="stat-card"><div class="stat-val" id="streak-val">0</div><div class="stat-label">MP Streak</div></div>
        <div class="stat-card"><div class="stat-val" id="words-val">0</div><div class="stat-label">Est. Words</div></div>
        <div class="stat-card"><div class="stat-val" id="cf-val">0</div><div class="stat-label">CF Solved</div></div>
    </div>

    <div class="controls">
        <button class="secondary" onclick="changeDay(-1)">← Previous</button>
        <h2 id="current-date-display" style="margin:0; font-size: 1.2rem;">Jan 1, 2026</h2>
        <button class="secondary" onclick="changeDay(1)">Next →</button>
    </div>

    <div id="day-container"></div>
    <div class="calendar-grid" id="calendar"></div>
</div>

<script>
    // --- PERSISTENCE LOGIC (GITHUB GIST) ---
    async function syncToCloud() {
        const token = document.getElementById('gh-token').value;
        const gistId = document.getElementById('gist-id').value;
        if (!token) return alert("Please enter a GitHub Token");

        const content = JSON.stringify(userState);
        const method = gistId ? 'PATCH' : 'POST';
        const url = gistId ? `https://api.github.com/gists/${gistId}` : 'https://api.github.com/gists';

        try {
            const response = await fetch(url, {
                method: method,
                headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    description: "Foundations 2026 Tracker Data",
                    public: false,
                    files: { "tracker_data.json": { content: content } }
                })
            });
            const data = await response.json();
            if (data.id) {
                document.getElementById('gist-id').value = data.id;
                localStorage.setItem('jan2026_gistid', data.id);
                alert("Data Saved to Cloud!");
            }
        } catch (err) { alert("Error saving: " + err); }
    }

    async function syncFromCloud() {
        const token = document.getElementById('gh-token').value;
        const gistId = document.getElementById('gist-id').value;
        if (!token || !gistId) return alert("Need Token and Gist ID to load");

        try {
            const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                headers: { 'Authorization': `token ${token}` }
            });
            const data = await response.json();
            const cloudData = JSON.parse(data.files["tracker_data.json"].content);
            userState = cloudData;
            saveState(); // Update local storage and UI
            renderDay(config.currentDate);
            alert("Data Loaded from Cloud!");
        } catch (err) { alert("Error loading: " + err); }
    }

    // --- APP DATA & LOGIC ---
    const config = { startDate: new Date("2026-01-01"), currentDate: new Date("2026-01-01") };
    let userState = JSON.parse(localStorage.getItem('jan2026_state')) || {};
    
    // Load Gist ID from local storage if exists
    document.getElementById('gist-id').value = localStorage.getItem('jan2026_gistid') || "";

    const planData = {}; 
    for (let i = 1; i <= 31; i++) {
        planData[i.toString()] = {
            title: i === 1 ? "New Year's Setup" : `Foundations Day ${i}`,
            tasks: [
                { time: "06:30", text: "Morning Pages", tag: "morning-pages" },
                { time: "09:00", text: "Research/EE678/EE610", tag: "academic" },
                { time: "18:00", text: "Coding/CF", tag: "coding" }
            ]
        };
    }

    function saveState() {
        localStorage.setItem('jan2026_state', JSON.stringify(userState));
        updateStats();
        renderCalendar();
    }

    function toggleTask(day, idx) {
        if (!userState[day]) userState[day] = { tasks: [] };
        if (userState[day].tasks.includes(idx)) {
            userState[day].tasks = userState[day].tasks.filter(t => t !== idx);
        } else {
            userState[day].tasks.push(idx);
        }
        saveState();
        renderDay(config.currentDate);
    }

    function saveNote(day) {
        const txt = document.getElementById(`note-${day}`).value;
        if (!userState[day]) userState[day] = { tasks: [] };
        userState[day].note = txt;
        saveState();
    }

    function updateStats() {
        let mpCount = 0;
        let totalCompleted = 0;
        Object.keys(userState).forEach(day => {
            if (userState[day].tasks.includes(0)) mpCount++;
            totalCompleted += userState[day].tasks.length;
        });
        document.getElementById('streak-val').innerText = mpCount;
        document.getElementById('progress-val').innerText = Math.round((totalCompleted / 93) * 100) + "%";
        document.getElementById('words-val').innerText = mpCount * 500;
        document.getElementById('cf-val').innerText = Math.floor(mpCount * 1.5);
    }

    function renderDay(dateObj) {
        const dayNum = dateObj.getDate().toString();
        const data = planData[dayNum];
        const state = userState[dayNum] || { tasks: [], note: "" };

        document.getElementById('current-date-display').innerText = dateObj.toDateString();
        let html = `<div class="day-view"><h2>${data.title}</h2><ul class="task-list">`;
        data.tasks.forEach((task, idx) => {
            const isChecked = state.tasks.includes(idx) ? 'checked' : '';
            html += `
                <li class="task-item ${isChecked ? 'completed' : ''}">
                    <input type="checkbox" class="checkbox" ${isChecked} onchange="toggleTask('${dayNum}', ${idx})">
                    <div class="task-content">
                        <span class="task-time">${task.time} <span class="tag ${task.tag}">${task.tag}</span></span>
                        <span class="task-desc">${task.text}</span>
                    </div>
                </li>`;
        });
        html += `</ul><textarea id="note-${dayNum}" oninput="saveNote('${dayNum}')" placeholder="Notes...">${state.note || ''}</textarea></div>`;
        document.getElementById('day-container').innerHTML = html;
        updateStats();
        renderCalendar();
    }

    function renderCalendar() {
        const cal = document.getElementById('calendar');
        cal.innerHTML = "";
        for(let i=1; i<=31; i++) {
            const state = userState[i.toString()] || { tasks: [] };
            const pct = (state.tasks.length / 3) * 100;
            const el = document.createElement('div');
            el.className = `cal-day ${config.currentDate.getDate() === i ? 'active' : ''}`;
            el.onclick = () => { config.currentDate = new Date(2026, 0, i); renderDay(config.currentDate); };
            el.innerHTML = `<span>${i}</span><div class="cal-status"><div class="cal-status-bar" style="width:${pct}%"></div></div>`;
            cal.appendChild(el);
        }
    }

    function changeDay(delta) {
        config.currentDate.setDate(config.currentDate.getDate() + delta);
        renderDay(config.currentDate);
    }

    // Init
    renderDay(config.startDate);
</script>
</body>
</html>
